"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2842],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>N});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=p(n),d=l,N=m["".concat(s,".").concat(d)]||m[d]||c[d]||r;return n?a.createElement(N,i(i({ref:t},u),{},{components:n})):a.createElement(N,i({ref:t},u))}));function N(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:l,i[1]=o;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9085:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=n(7462),l=(n(7294),n(3905));const r={sidebar_position:4},i="JSON Storage",o={unversionedId:"storages/supported-storages/json-storage",id:"storages/supported-storages/json-storage",title:"JSON Storage",description:"Introduction",source:"@site/docs/storages/supported-storages/json-storage.md",sourceDirName:"storages/supported-storages",slug:"/storages/supported-storages/json-storage",permalink:"/docs/0.14/storages/supported-storages/json-storage",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"autoSidebar",previous:{title:"Sled Storage",permalink:"/docs/0.14/storages/supported-storages/sled-storage"},next:{title:"WebStorage (local & session)",permalink:"/docs/0.14/storages/supported-storages/web-storage"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Structure",id:"structure",level:2},{value:"Schema File",id:"schema-file",level:2},{value:"Schemaless Table",id:"schemaless-table",level:3},{value:"Data File",id:"data-file",level:2},{value:"<code>*.jsonl</code> File Format",id:"jsonl-file-format",level:3},{value:"<code>*.json</code> File Format",id:"json-file-format",level:3},{value:"Examples",id:"examples",level:2},{value:"Read Existing JSON/JSONL Schemaless Files",id:"read-existing-jsonjsonl-schemaless-files",level:3},{value:"Create Schema Table",id:"create-schema-table",level:3},{value:"Limitation",id:"limitation",level:2}],u={toc:p},m="wrapper";function c(e){let{components:t,...n}=e;return(0,l.kt)(m,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"json-storage"},"JSON Storage"),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"The JSON Storage system is comprised of two types of files: ",(0,l.kt)("a",{parentName:"p",href:"#schema-file"},"Schema file"),"(optional) and ",(0,l.kt)("a",{parentName:"p",href:"#data-file"},"Data file"),". The Schema file is written in Standard SQL and is responsible for storing the structure of the table. The Data file contains the actual data and supports two file formats: ",(0,l.kt)("inlineCode",{parentName:"p"},"*.json")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"*.jsonl"),". This document provides detailed ",(0,l.kt)("a",{parentName:"p",href:"#examples"},"examples")," of how to create schema and read/write data using the Json Storage system. While it supports all DML features, it is particularly specialized for ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"APPEND INSERT"),". For further information, please refer to the ",(0,l.kt)("a",{parentName:"p",href:"#limitation"},"Limitations")," section."),(0,l.kt)("h2",{id:"structure"},"Structure"),(0,l.kt)("p",null,"JSON Storage is based on two types of files: ",(0,l.kt)("inlineCode",{parentName:"p"},"Schema")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"Data"),". The ",(0,l.kt)("inlineCode",{parentName:"p"},"Schema")," file contains the definition of the structure of the data, while the ",(0,l.kt)("inlineCode",{parentName:"p"},"Data")," file contains the actual data."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"gluesql> CREATE TABLE User (\n    id INT,\n    name TEXT\n)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ ls -l\n\nUser.sql # Schema file\nUser.jsonl # Data file\n")),(0,l.kt)("h2",{id:"schema-file"},"Schema File"),(0,l.kt)("p",null,"The schema definition is saved in a file named ",(0,l.kt)("inlineCode",{parentName:"p"},"{TABLE_NAME}.sql")," using standard SQL. For example, if the table name is ",(0,l.kt)("inlineCode",{parentName:"p"},"User"),", then the schema file will be named ",(0,l.kt)("inlineCode",{parentName:"p"},"User.sql"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"--! User.sql\nCREATE TABLE User (\n  id INT,\n  name TEXT,\n);\n")),(0,l.kt)("h3",{id:"schemaless-table"},"Schemaless Table"),(0,l.kt)("p",null,"A schemaless table is optional, and if there is no corresponding ",(0,l.kt)("inlineCode",{parentName:"p"},"{TABLE_NAME}.sql")," file, the table is schemaless. A schemaless table can save any data regardless of column name and data type."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"gluesql> CREATE Table User;\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ ls -l\n\nUser.jsonl\n")),(0,l.kt)("h2",{id:"data-file"},"Data File"),(0,l.kt)("p",null,"JSON Storage saves data in two types of data files: ",(0,l.kt)("inlineCode",{parentName:"p"},"*.jsonl")," (default) and ",(0,l.kt)("inlineCode",{parentName:"p"},"*.json"),"."),(0,l.kt)("h3",{id:"jsonl-file-format"},(0,l.kt)("inlineCode",{parentName:"h3"},"*.jsonl")," File Format"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"*.jsonl")," file format is a file containing one JSON object per line. For example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{"id": 1, "name": "Glue"}\n{"id": 2, "name": "SQL"}\n')),(0,l.kt)("h3",{id:"json-file-format"},(0,l.kt)("inlineCode",{parentName:"h3"},"*.json")," File Format"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"*.json")," file format supports two different formats:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Array of JSON")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": 1,\n    "name": "Glue"\n  },\n  {\n    "id": 2,\n    "name": "SQL"\n  }\n]\n')),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Single JSON")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "GlueSQL"\n  "keywords": ["Database, Rust"]\n  "stars": 999999\n}\n')),(0,l.kt)("h2",{id:"examples"},"Examples"),(0,l.kt)("h3",{id:"read-existing-jsonjsonl-schemaless-files"},"Read Existing JSON/JSONL Schemaless Files"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Locate your JSON/JSONL schemaless files in the data path. Here, we use ",(0,l.kt)("inlineCode",{parentName:"li"},"./data"),".")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ ls -rlt ./data\n\nUser.json\nLoginHistory.jsonl\n")),(0,l.kt)("p",null,"Keep in mind that if there are no ",(0,l.kt)("inlineCode",{parentName:"p"},"*.sql")," files, the data is considered schemaless, meaning that the number of columns in each row may vary."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'//! User.json\n[\n  {\n    "id": 1,\n    "name": "Alice",\n    "location": "New York"\n  },\n  {\n    "id": 2,\n    "name": "Bob",\n    "language": "Rust"\n  },\n  {\n    "id": 3,\n    "name": "Eve"\n  }\n]\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'//! LoginHistory.jsonl\n{"timestamp": "2023-05-01T14:36:22.000Z", "userId": 1, "action": "login"}\n{"timestamp": "2023-05-01T14:38:17.000Z", "userId": 2, "action": "logout"}\n{"timestamp": "2023-05-02T08:12:05.000Z", "userId": 2, "action": "logout"}\n{"timestamp": "2023-05-02T09:45:13.000Z", "userId": 3, "action": "login"}\n{"timestamp": "2023-05-03T16:21:44.000Z", "userId": 1, "action": "logout"}\n')),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Read with GlueSQL JSON Storage")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},'let path = "./data/";\nlet json_storage = JsonStorage::new(path).unwrap();\nlet mut glue = Glue::new(json_storage);\n\nglue.execute("\nSELECT *\nFROM User U\nJOIN LoginHistory L ON U.id = L.userId;\n");\n')),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"action"),(0,l.kt)("th",{parentName:"tr",align:null},"id"),(0,l.kt)("th",{parentName:"tr",align:null},"language"),(0,l.kt)("th",{parentName:"tr",align:null},"location"),(0,l.kt)("th",{parentName:"tr",align:null},"name"),(0,l.kt)("th",{parentName:"tr",align:null},"timestamp"),(0,l.kt)("th",{parentName:"tr",align:null},"userId"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"login"),(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"New York"),(0,l.kt)("td",{parentName:"tr",align:null},"Alice"),(0,l.kt)("td",{parentName:"tr",align:null},"2023-05-01T14:36:22.000Z"),(0,l.kt)("td",{parentName:"tr",align:null},"1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"logout"),(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"New York"),(0,l.kt)("td",{parentName:"tr",align:null},"Alice"),(0,l.kt)("td",{parentName:"tr",align:null},"2023-05-03T16:21:44.000Z"),(0,l.kt)("td",{parentName:"tr",align:null},"1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"logout"),(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"Rust"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Bob"),(0,l.kt)("td",{parentName:"tr",align:null},"2023-05-01T14:38:17.000Z"),(0,l.kt)("td",{parentName:"tr",align:null},"2")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"logout"),(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"Rust"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Bob"),(0,l.kt)("td",{parentName:"tr",align:null},"2023-05-02T08:12:05.000Z"),(0,l.kt)("td",{parentName:"tr",align:null},"2")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"login"),(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null},"Eve"),(0,l.kt)("td",{parentName:"tr",align:null},"2023-05-02T09:45:13.000Z"),(0,l.kt)("td",{parentName:"tr",align:null},"3")))),(0,l.kt)("h3",{id:"create-schema-table"},"Create Schema Table"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Create Table")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},'let path = "./data/";\nlet json_storage = JsonStorage::new(path).unwrap();\nlet mut glue = Glue::new(json_storage);\n\nglue.execute("\nCREATE TABLE Account (\n  accountId INT NOT NULL,\n  accountOwner TEXT NOT NULL,\n  accountType TEXT NOT NULL,\n  balance INT NOT NULL,\n  isActive BOOLEAN NOT NULL\n);\n");\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ ls -l\n\nAccount.sql\nAccount.jsonl\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Verity Schema file")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"--! Account.sql\nCREATE TABLE Account (\n  accountId INT NOT NULL,\n  accountOwner TEXT NOT NULL,\n  accountType TEXT NOT NULL,\n  balance INT NOT NULL,\n  isActive BOOLEAN NOT NULL\n);\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Insert data")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"glue.execute(\"\nINSERT INTO Account VALUES\n  (10001, 'John Smith', 'Checking', 5000, true),\n  (10002, 'Jane Doe', 'Savings', 10000, true),\n  (10003, 'Robert Johnson', 'Checking', 2500, false),\n  (10004, 'Alice Kim', 'Savings', 7500, true),\n  (10005, 'Michael Chen', 'Checking', 10000, true);\n\");\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"Select data")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},'glue.execute("SELECT * FROM Account;");\n')),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"accountId"),(0,l.kt)("th",{parentName:"tr",align:null},"accountOwner"),(0,l.kt)("th",{parentName:"tr",align:null},"accountType"),(0,l.kt)("th",{parentName:"tr",align:null},"balance"),(0,l.kt)("th",{parentName:"tr",align:null},"isActive"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10001"),(0,l.kt)("td",{parentName:"tr",align:null},"John Smith"),(0,l.kt)("td",{parentName:"tr",align:null},"Checking"),(0,l.kt)("td",{parentName:"tr",align:null},"5000"),(0,l.kt)("td",{parentName:"tr",align:null},"TRUE")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10002"),(0,l.kt)("td",{parentName:"tr",align:null},"Jane Doe"),(0,l.kt)("td",{parentName:"tr",align:null},"Savings"),(0,l.kt)("td",{parentName:"tr",align:null},"10000"),(0,l.kt)("td",{parentName:"tr",align:null},"TRUE")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10003"),(0,l.kt)("td",{parentName:"tr",align:null},"Robert Johnson"),(0,l.kt)("td",{parentName:"tr",align:null},"Checking"),(0,l.kt)("td",{parentName:"tr",align:null},"2500"),(0,l.kt)("td",{parentName:"tr",align:null},"FALSE")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10004"),(0,l.kt)("td",{parentName:"tr",align:null},"Alice Kim"),(0,l.kt)("td",{parentName:"tr",align:null},"Savings"),(0,l.kt)("td",{parentName:"tr",align:null},"7500"),(0,l.kt)("td",{parentName:"tr",align:null},"TRUE")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"10005"),(0,l.kt)("td",{parentName:"tr",align:null},"Michael Chen"),(0,l.kt)("td",{parentName:"tr",align:null},"Checking"),(0,l.kt)("td",{parentName:"tr",align:null},"10000"),(0,l.kt)("td",{parentName:"tr",align:null},"TRUE")))),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},"Verify Data file")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'//! Account.jsonl\n{"accountId":10001,"accountOwner":"John Smith","accountType":"Checking","balance":5000,"isActive":true}\n{"accountId":10002,"accountOwner":"Jane Doe","accountType":"Savings","balance":10000,"isActive":true}\n{"accountId":10003,"accountOwner":"Robert Johnson","accountType":"Checking","balance":2500,"isActive":false}\n{"accountId":10004,"accountOwner":"Alice Kim","accountType":"Savings","balance":7500,"isActive":true}\n{"accountId":10005,"accountOwner":"Michael Chen","accountType":"Checking","balance":10000,"isActive":true}\n')),(0,l.kt)("h2",{id:"limitation"},"Limitation"),(0,l.kt)("p",null,"JSON Storage is capable of supporting a variety of operations, including ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"INSERT"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"DELETE"),", and ",(0,l.kt)("inlineCode",{parentName:"p"},"UPDATE"),".",(0,l.kt)("br",{parentName:"p"}),"\n","However, its design primarily emphasizes ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"APPEND INSERT")," functionality.",(0,l.kt)("br",{parentName:"p"}),"\n","It's important to note that if you perform ",(0,l.kt)("inlineCode",{parentName:"p"},"DELETE"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"UPDATE"),", or ",(0,l.kt)("inlineCode",{parentName:"p"},"INSERT in the middle of the rows"),", it can cause the internal rewriting of all the rows, which can lead to a decrease in performance."))}c.isMDXComponent=!0}}]);